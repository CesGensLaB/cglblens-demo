<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <title>Highlight X-Window</title>
</head>
<body>
  <div id="plot"></div>
  <script>
    // Data for the two curves
    const x = [0, 1, 2, 3, 4, 5];
    const curve1 = [1, 2, 3, 4, 5, 6];
    const curve2 = [1, 2, 2.5, 4, 5, 6];

    // Define the x-window to highlight
    const xMin = 1;
    const xMax = 3;

    // Mask data outside the x-window
    const maskedX = x.map((xi) => (xi >= xMin && xi <= xMax ? xi : null));
    const upperDiff = curve1.map((y1, i) =>
      maskedX[i] !== null ? Math.max(y1, curve2[i]) : null
    );
    const lowerDiff = curve1.map((y1, i) =>
      maskedX[i] !== null ? Math.min(y1, curve2[i]) : null
    );

    // Trace for curve1
    const trace1 = {
      x: x,
      y: curve1,
      mode: 'lines',
      name: 'Curve 1',
      line: { color: 'blue' },
    };

    // Trace for curve2
    const trace2 = {
      x: x,
      y: curve2,
      mode: 'lines',
      name: 'Curve 2',
      line: { color: 'red' },
    };

    // Highlight difference in the x-window
    const highlightDiff = {
      x: [...maskedX, ...maskedX.slice().reverse()],
      y: [...upperDiff, ...lowerDiff.slice().reverse()],
      fill: 'toself',
      fillcolor: 'rgba(0, 200, 100, 0.3)',
      line: { width: 0 },
      name: 'Highlighted Difference',
      type: 'scatter',
    };

    // Add x-window shading using layout shapes
    const layout = {
      title: 'Highlight X-Window of Differences',
      xaxis: { title: 'X-axis' },
      yaxis: { title: 'Y-axis' },
      shapes: [
        {
          type: 'rect',
          xref: 'x',
          yref: 'paper',
          x0: xMin,
          x1: xMax,
          y0: 0,
          y1: 1,
          fillcolor: 'rgba(255, 255, 0, 0.2)',
          line: { width: 0 },
        },
      ],
    };

    // Combine all traces
    const data = [trace1, trace2, highlightDiff];
    console.log(data);

    Plotly.newPlot('plot', data, layout);
  </script>
</body>
</html>
